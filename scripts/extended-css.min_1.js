/**
 * @adguard/extended-css - v2.0.44 - Fri Jan 27 2023
 * https://github.com/AdguardTeam/ExtendedCss#homepage
 * Copyright (c) 2023 AdGuard. Licensed GPL-3.0
 */
var ExtendedCss=function(){"use strict";function e(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const t="SelectorList",r="Selector",s="RegularSelector",o="ExtendedSelector",n="AbsolutePseudoClass",l="RelativePseudoClass";class a{constructor(t){e(this,"children",[]),this.type=t}addChild(e){this.children.push(e)}}class i extends a{constructor(e){super(s),this.value=e}}class c extends a{constructor(e){super(l),this.name=e}}class u extends a{constructor(t){super(n),e(this,"value",""),this.name=t}}const d={LEFT:"[",RIGHT:"]"},h={LEFT:"(",RIGHT:")"},f={LEFT:"{",RIGHT:"}"},p="/",w="\\",m=" ",v=",",E=";",g=":",b="'",y='"',$="=",k="\t",S="\r",x="\n",T="\f",N=[m,k,S,x,T],P="*",O=m,R=">",A="+",I="~",C=[O,R,A,I],L=["[","]","(",")","{","}",p,w,E,g,v,b,y,"^","$",P,"#",".",O,R,A,I,k,S,x,T],B=[g,E,b,y,w,m,k,S,x,T],M="contains",D="has-text",F="-abp-contains",W="matches-css",V="matches-css-before",G="matches-css-after",U="matches-attr",j="matches-property",q="xpath",H="nth-ancestor",_=[M,D,F],Q="upward",z="remove",K="-abp-has",X=["has",K],J="is",Y="not",Z=[M,D,F,W,V,G,U,j,q,H,Q],ee=[...X,J,Y],te=[...Z,...ee],re=[Y,J],se={AFTER:"after",BACKDROP:"backdrop",BEFORE:"before",CUE:"cue",CUE_REGION:"cue-region",FIRST_LETTER:"first-letter",FIRST_LINE:"first-line",FILE_SELECTION_BUTTON:"file-selector-button",GRAMMAR_ERROR:"grammar-error",MARKER:"marker",PART:"part",PLACEHOLDER:"placeholder",SELECTION:"selection",SLOTTED:"slotted",SPELLING_ERROR:"spelling-error",TARGET_TEXT:"target-text"},oe="content",ne="true",le="global",ae="Selector should be defined",ie="No style declaration found",ce="Selector should be defined before style declaration in stylesheet",ue="Invalid style declaration",de="Unclosed style declaration",he="Missing style property in declaration",fe="Missing style value in declaration",pe="Style should be declared or :remove() pseudo-class should used",we="Comments are not supported",me="Invalid :remove() pseudo-class in selector",ve="Selector should be defined before :remove() pseudo-class",Ee="Pseudo-class :remove() appears more than once in selector",ge="Pseudo-class :remove() should be at the end of selector",be=/\[-(?:ext)-([a-z-_]+)=(["'])((?:(?=(\\?))\4.)*?)\2\]/g,ye=(e,t,r,s)=>{const o=new RegExp(`([^\\\\]|^)\\\\${r}`,"g");return`:${t}(${s.replace(o,`$1${r}`)})`},$e=/\(:scope >/g,ke=/(:matches-css)-(before|after)\(/g,Se=(e,t,r)=>`${t}${h.LEFT}${r},`,xe=e=>(e=>{const t=e.replace(be,ye).replace($e,"(>").replace(ke,Se);if(t.includes("[-ext-"))throw new Error(`Invalid extended-css old syntax selector: '${e}'`);return t})(e.trim()),Te="mark",Ne="word",Pe=(e,t)=>{let r="";const s=[];return e.split("").forEach((e=>{if(t.includes(e))return r.length>0&&(s.push({type:Ne,value:r}),r=""),void s.push({type:Te,value:e});r+=e})),r.length>0&&s.push({type:Ne,value:r}),s},Oe=e=>{const t=[];e.forEach((e=>t.push(e)));const r=[];for(;t.length;){const e=t.pop();if(!e)throw new Error("Unable to make array flat");Array.isArray(e)?e.forEach((e=>t.push(e))):r.push(e)}return r.reverse()},Re=e=>e[0],Ae=e=>e[e.length-1],Ie=e=>e[e.length-2],Ce=(e,t,r)=>{const s=e[t];if(!s)throw new Error(r||`No array item found by index ${t}`);return s},Le="At least one of Selector node children should be RegularSelector",Be=e=>(null==e?void 0:e.type)===t,Me=e=>(null==e?void 0:e.type)===r,De=e=>(null==e?void 0:e.type)===s,Fe=e=>e.type===o,We=e=>(null==e?void 0:e.type)===n,Ve=e=>(null==e?void 0:e.type)===l,Ge=e=>{if(null===e)throw new Error("Ast node should be defined");if(!We(e)&&!Ve(e))throw new Error("Only AbsolutePseudoClass or RelativePseudoClass ast node can have a name");if(!e.name)throw new Error("Extended pseudo-class should have a name");return e.name},Ue=(e,t)=>{if(null===e)throw new Error("Ast node should be defined");if(!De(e)&&!We(e))throw new Error("Only RegularSelector ot AbsolutePseudoClass ast node can have a value");if(!e.value)throw new Error(t||"Ast RegularSelector ot AbsolutePseudoClass node should have a value");return e.value},je=e=>e.filter(De),qe=e=>{const t=je(e),r=Ae(t);if(!r)throw new Error(Le);return r},He=(e,t)=>{if(1!==e.children.length)throw new Error(t);const r=Re(e.children);if(!r)throw new Error(t);return r},_e=e=>He(e,"Extended selector should be specified"),Qe=e=>{if(!Ve(e))throw new Error("Only RelativePseudoClass node can have relative SelectorList node as child");return He(e,`Missing arg for :${Ge(e)}() pseudo-class`)},ze={COMMON:[h.LEFT,b,y,$,".",g,m],CONTAINS:[h.LEFT,b,y]},Ke=e=>te.includes(e),Xe=e=>re.includes(e),Je=(e,t)=>!(!e||!t)&&(C.includes(t)||e===Ne||t===P||"#"===t||"."===t||t===g||t===b||t===y||t===d.LEFT),Ye=(e,t,r)=>{const s=Ae(e.extendedPseudoNamesStack);if(!s)throw new Error("Regexp pattern allowed only in arg of extended pseudo-class");if(_.includes(s))return ze.CONTAINS.includes(t);if(t===p&&s!==q){throw new Error(`Invalid regexp pattern for :${s}() pseudo-class ${r?`in arg part: '${r}'`:"arg"}`)}return ze.COMMON.includes(t)},Ze=(e,t)=>e===d.LEFT&&t!==w,et=e=>{var t;if(!e.isAttributeBracketsOpen)return!1;const r=e.attributeBuffer.split(m).join(""),s=Pe(r,[...L,$]);const o=Re(s),n=null==o?void 0:o.type,l=null==o?void 0:o.value;if(n===Te&&l!==w)throw new Error(`'[${e.attributeBuffer}]' is not a valid attribute due to '${l}' at start of it`);const a=Ae(s),i=null==a?void 0:a.type,c=null==a?void 0:a.value;if(c===$)throw new Error(`'[${e.attributeBuffer}]' is not a valid attribute due to '='`);const u=s.findIndex((e=>e.type===Te&&e.value===$)),d=null===(t=Ie(s))||void 0===t?void 0:t.value;if(-1===u)return i===Ne||d===w&&(c===y||c===b);const h=Ce(s,u+1).value;if(!(h===b||h===y)){if(i===Ne)return!0;throw new Error(`'[${e.attributeBuffer}]' is not a valid attribute`)}return i===Ne&&"i"===(null==c?void 0:c.toLocaleLowerCase())?d===h:c===h},tt=e=>!!e&&N.includes(e),rt=e=>Z.includes(e),st=e=>ee.includes(e),ot=e=>0===e.pathToBufferNode.length?null:Ae(e.pathToBufferNode)||null,nt=e=>{const t=ot(e);if(!t)throw new Error("No bufferNode found");if(!Me(t))throw new Error("Unsupported bufferNode type");const r=qe(t.children);return e.pathToBufferNode.push(r),r},lt=(e,t)=>{const r=ot(e);if(null===r)throw new Error("No bufferNode to update");if(We(r))r.value+=t;else{if(!De(r))throw new Error(`${r.type} node cannot be updated. Only RegularSelector and AbsolutePseudoClass are supported`);r.value+=t,e.isAttributeBracketsOpen&&(e.attributeBuffer+=t)}},at=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const o=ot(e);if(null===o)throw new Error("No buffer node");let d;d=t===s?new i(r):t===n?new u(r):t===l?new c(r):new a(t),o.addChild(d),e.pathToBufferNode.push(d)},it=(e,o)=>{(e=>{const r=new a(t);e.ast=r,e.pathToBufferNode.push(r)})(e),at(e,r),at(e,s,o)},ct=function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";at(e,t),at(e,r),at(e,s,o)},ut=(e,t)=>{for(let s=e.pathToBufferNode.length-1;s>=0;s-=1){var r;if((null===(r=e.pathToBufferNode[s])||void 0===r?void 0:r.type)===t){e.pathToBufferNode=e.pathToBufferNode.slice(0,s+1);break}}},dt=e=>{const t=ot(e);if(t&&Be(t)&&Ve((e=>e.pathToBufferNode.length<2?null:Ie(e.pathToBufferNode)||null)(e)))return t;ut(e,r);const s=ot(e);if(!s)throw new Error("No SelectorNode, impossible to continue selector parsing by ExtendedCss");const o=Ae(s.children),n=o&&Fe(o)&&0===e.standardPseudoBracketsStack.length,l=n&&Re(o.children);let a=s;if(l){const t=n&&l.name,r=t&&st(t),s=t&&rt(t),i=r&&e.extendedPseudoBracketsStack.length>0&&e.extendedPseudoBracketsStack.length===e.extendedPseudoNamesStack.length,c=s&&t===Ae(e.extendedPseudoNamesStack);(i||c)&&(e.pathToBufferNode.push(o),a=l)}else a=n?s:nt(e);return e.pathToBufferNode.push(a),a},ht=(e,t,s,n,l)=>{if(!n)throw new Error(`Invalid colon ':' at the end of selector: '${t}'`);if(Ke(n.toLowerCase())){if(X.includes(n)&&e.standardPseudoNamesStack.length>0)throw new Error(`Usage of :${n}() pseudo-class is not allowed inside regular pseudo: '${Ae(e.standardPseudoNamesStack)}'`);ut(e,r),at(e,o)}else{if(n.toLowerCase()===z)throw new Error(`${me}: '${t}'`);lt(e,s),l&&l===h.LEFT&&!e.isAttributeBracketsOpen&&e.standardPseudoNamesStack.push(n)}},ft=(e,t)=>(e.children=t,e),pt=e=>{if(null===e)return!1;const t=_e(e),r=Ge(t);if(rt(r))return!1;const s=Qe(t).children;if(Xe(r)){if(s.every((e=>{try{const t=He(e,"Selector node should have RegularSelector");return De(t)}catch(e){return!1}})))return!0}return s.some((e=>e.children.some((e=>!!Fe(e)&&pt(e)))))},wt=(e,t)=>{if(!e)return null;const r=_e(e),s=Qe(r);if(!s.children.some((e=>e.children.some((e=>Fe(e)))))){const e=(e=>e.children.map((e=>{const t=He(e,"Ast Selector node should have RegularSelector node");return Ue(t)})).join(", "))(s),o=`:${Ge(r)}${h.LEFT}${e}${h.RIGHT}`;return t.value=`${Ue(t)}${o}`,null}const o=mt(s),n=ft(r,[o]);return ft(e,[n])},mt=e=>ft(e,e.children.map((e=>(e=>{const t=e.children,r=[];let s=0;for(;s<t.length;){const e=Ce(t,s,"currentChild should be specified");if(0===s)r.push(e);else{const t=qe(r);if(Fe(e)){let s=null,o=pt(e);for(s=e;o;)s=wt(s,t),o=pt(s);if(null!==s){r.push(s);const e=_e(s),o=Ge(e);Ue(t)===P&&Xe(o)&&(t.value="html *")}}else if(De(e)){const s=Ae(r)||null;De(s)&&(o=e,(n=t).value=`${Ue(n)} ${Ue(o)}`)}}s+=1}var o,n;return ft(e,r)})(e)))),vt="No white space is allowed before or after extended pseudo-class name in selector",Et=e=>{const a=(e=>{const t=xe(e);return Pe(t,L)})(e),i={ast:null,pathToBufferNode:[],extendedPseudoNamesStack:[],extendedPseudoBracketsStack:[],standardPseudoNamesStack:[],standardPseudoBracketsStack:[],isAttributeBracketsOpen:!1,attributeBuffer:"",isRegexpOpen:!1,shouldOptimize:!1};let c=0;for(;c<a.length;){const u=a[c];if(!u)break;const{type:$,value:N}=u,L=a[c+1],B=null==L?void 0:L.type,M=null==L?void 0:L.value,D=a[c+2],F=null==D?void 0:D.value,W=a[c-1],V=null==W?void 0:W.type,G=null==W?void 0:W.value,U=a[c-2],j=null==U?void 0:U.value;let _=ot(i);switch($){case Ne:if(null===_)it(i,N);else if(Be(_))at(i,r),at(i,s,N);else if(De(_))lt(i,N);else if(Fe(_)){if(tt(M)&&F===h.LEFT)throw new Error(`${vt}: '${e}'`);const t=N.toLowerCase();i.extendedPseudoNamesStack.push(t),rt(t)?at(i,n,t):(at(i,l,t),Xe(t)&&(i.shouldOptimize=!0))}else We(_)?lt(i,N):Ve(_)&&ct(i,N);break;case Te:switch(N){case v:if(!_||void 0!==_&&!M)throw new Error(`'${e}' is not a valid selector`);De(_)?i.isAttributeBracketsOpen?lt(i,N):ut(i,t):We(_)?lt(i,N):Me(_)&&ut(i,t);break;case m:if(De(_)&&!i.isAttributeBracketsOpen&&(_=dt(i)),De(_)){if(!i.isAttributeBracketsOpen&&(G===g&&B===Ne||V===Ne&&M===h.LEFT))throw new Error(`'${e}' is not a valid selector`);(!M||Je(B,M)||i.isAttributeBracketsOpen)&&lt(i,N)}We(_)&&lt(i,N),Ve(_)&&ct(i),Me(_)&&Je(B,M)&&at(i,s);break;case O:case R:case A:case I:case E:case p:case w:case b:case y:case"^":case"$":case f.LEFT:case f.RIGHT:case P:case"#":case".":case d.LEFT:if(C.includes(N)){if(null===_)throw new Error(`'${e}' is not a valid selector`);_=dt(i)}if(null===_)it(i,N),Ze(N,G)&&(i.isAttributeBracketsOpen=!0);else if(De(_)){if(N===f.LEFT&&!i.isAttributeBracketsOpen&&!i.isRegexpOpen)throw new Error(`'${e}' is not a valid selector`);lt(i,N),Ze(N,G)&&(i.isAttributeBracketsOpen=!0)}else We(_)?(lt(i,N),N===p&&i.extendedPseudoNamesStack.length>0&&(G===p&&j===w?i.isRegexpOpen=!1:G&&G!==w&&(Ye(i,G,Ue(_))?i.isRegexpOpen=!i.isRegexpOpen:i.isRegexpOpen=!1))):Ve(_)?(ct(i,N),Ze(N,G)&&(i.isAttributeBracketsOpen=!0)):Me(_)?C.includes(N)?at(i,s,N):i.isRegexpOpen||(_=nt(i),lt(i,N),Ze(N,G)&&(i.isAttributeBracketsOpen=!0)):Be(_)&&(at(i,r),at(i,s,N),Ze(N,G)&&(i.isAttributeBracketsOpen=!0));break;case d.RIGHT:if(De(_)){if(!i.isAttributeBracketsOpen&&G!==w)throw new Error(`'${e}' is not a valid selector due to '${N}' after '${Ue(_)}'`);et(i)&&(i.isAttributeBracketsOpen=!1,i.attributeBuffer=""),lt(i,N)}We(_)&&lt(i,N);break;case g:if(tt(M)&&F&&te.includes(F))throw new Error(`${vt}: '${e}'`);if(null===_){if(M===q)it(i,"body");else{if(M===Q||M===H)throw new Error(`Selector should be defined before :${M}() pseudo-class`);it(i,P)}_=ot(i)}if(Be(_)&&(at(i,r),at(i,s),_=ot(i)),De(_)&&((G&&C.includes(G)||G===v)&&lt(i,P),ht(i,e,N,M,F)),Me(_)){if(!M)throw new Error(`Invalid colon ':' at the end of selector: '${e}'`);if(Ke(M.toLowerCase()))at(i,o);else{if(M.toLowerCase()===z)throw new Error(`${me}: '${e}'`);_=nt(i),ht(i,e,N,B,F)}}if(We(_)){if(Ge(_)===q&&M&&te.includes(M)&&F===h.LEFT)throw new Error(`:xpath() pseudo-class should be the last in selector: '${e}'`);lt(i,N)}if(Ve(_)){if(!M)throw new Error(`Invalid pseudo-class arg at the end of selector: '${e}'`);ct(i,P),Ke(M.toLowerCase())?(ut(i,r),at(i,o)):(lt(i,N),F===h.LEFT&&i.standardPseudoNamesStack.push(M))}break;case h.LEFT:We(_)&&(Ge(_)!==q&&i.isRegexpOpen?lt(i,N):(i.extendedPseudoBracketsStack.push(N),i.extendedPseudoBracketsStack.length>i.extendedPseudoNamesStack.length&&lt(i,N))),De(_)&&(i.standardPseudoNamesStack.length>0&&(lt(i,N),i.standardPseudoBracketsStack.push(N)),i.isAttributeBracketsOpen&&lt(i,N)),Ve(_)&&i.extendedPseudoBracketsStack.push(N);break;case h.RIGHT:if(We(_)&&(Ge(_)!==q&&i.isRegexpOpen?lt(i,N):(i.extendedPseudoBracketsStack.pop(),Ge(_)!==q?(i.extendedPseudoNamesStack.pop(),i.extendedPseudoBracketsStack.length>i.extendedPseudoNamesStack.length?lt(i,N):i.extendedPseudoBracketsStack.length>=0&&i.extendedPseudoNamesStack.length>=0&&ut(i,r)):i.extendedPseudoBracketsStack.length<i.extendedPseudoNamesStack.length?i.extendedPseudoNamesStack.pop():lt(i,N))),De(_))if(i.isAttributeBracketsOpen)lt(i,N);else if(i.standardPseudoNamesStack.length>0&&i.standardPseudoBracketsStack.length>0){lt(i,N),i.standardPseudoBracketsStack.pop();const t=i.standardPseudoNamesStack.pop();if(!t)throw new Error(`Parsing error. Invalid selector: ${e}`);if(Object.values(se).includes(t)&&M===g&&F&&X.includes(F))throw new Error(`Usage of :${F}() pseudo-class is not allowed after any regular pseudo-element: '${t}'`)}else i.extendedPseudoBracketsStack.pop(),i.extendedPseudoNamesStack.pop(),ut(i,o),ut(i,r);Me(_)&&(i.extendedPseudoBracketsStack.pop(),i.extendedPseudoNamesStack.pop(),ut(i,o),ut(i,r)),Ve(_)&&i.extendedPseudoNamesStack.length>0&&i.extendedPseudoBracketsStack.length>0&&(i.extendedPseudoBracketsStack.pop(),i.extendedPseudoNamesStack.pop());break;case x:case T:case S:throw new Error(`'${e}' is not a valid selector`);case k:if(!De(_)||!i.isAttributeBracketsOpen)throw new Error(`'${e}' is not a valid selector`);lt(i,N)}break;default:throw new Error(`Unknown type of token: '${N}'`)}c+=1}if(null===i.ast)throw new Error(`'${e}' is not a valid selector`);if(i.extendedPseudoNamesStack.length>0||i.extendedPseudoBracketsStack.length>0)throw new Error(`Unbalanced brackets for extended pseudo-class: '${Ae(i.extendedPseudoNamesStack)}'`);if(i.isAttributeBracketsOpen)throw new Error(`Unbalanced attribute brackets in selector: '${e}'`);return i.shouldOptimize?(u=i.ast,mt(u)):i.ast;var u},gt={MutationObserver:window.MutationObserver||window.WebKitMutationObserver};const bt=new class{constructor(){this.nativeNode=window.Node||Node}setGetter(){var e;this.getter=null===(e=Object.getOwnPropertyDescriptor(this.nativeNode.prototype,"textContent"))||void 0===e?void 0:e.get}},yt=e=>{let t=e.tagName.toLowerCase();return t+=Array.from(e.attributes).map((t=>`[${t.name}="${e.getAttribute(t.name)}"]`)).join(""),t},$t=e=>e instanceof HTMLElement,kt=(e,t)=>{const{parentElement:r}=e;if(!r)throw new Error(t||"Element does no have parent element");return r},St=e=>(e=>{if("object"==typeof(t=e)&&null!==t&&"message"in t&&"string"==typeof t.message)return e;var t;try{return new Error(JSON.stringify(e))}catch{return new Error(String(e))}})(e).message,xt={error:"undefined"!=typeof console&&console.error&&console.error.bind?console.error.bind(window.console):console.error,info:"undefined"!=typeof console&&console.info&&console.info.bind?console.info.bind(window.console):console.info},Tt=(e,t,r)=>e?e.split(t).join(r):e,Nt=e=>{if(e.startsWith(p)&&e.endsWith(p))return new RegExp(e.slice(1,-1));const t=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return new RegExp(t)},Pt=e=>{let t;switch(e){case void 0:t="undefined";break;case null:t="null";break;default:t=e.toString()}return t},Ot=e=>{const t=Number(e);let r;if(Number.isNaN(t))switch(e){case"undefined":r=void 0;break;case"null":r=null;break;case"true":r=!0;break;case"false":r=!1;break;default:r=e}else r=t;return r},Rt=/\sVersion\/(\d{2}\.\d)(.+\s|\s)(Safari)\//.test(navigator.userAgent),At="background",It="background-image",Ct="content",Lt="opacity",Bt=".*",Mt=/^\s*\/.*\/[gmisuy]*\s*$/,Dt=e=>{if(!e.includes('url("')){const t=/url\((.*?)\)/g;return e.replace(t,'url("$1")')}return e},Ft=e=>e.replace(/(\^)?url(\\)?\\\((\w|\[\w)/g,'$1url$2\\(\\"?$3'),Wt=Dt,Vt=e=>{let t;return e.startsWith(p)&&e.endsWith(p)?(t=Ft(e),t=t.slice(1,-1)):(t=Wt(e),t=t.replace(/\\([\\()[\]"])/g,"$1"),t=(e=>{const t=new RegExp(`[${[".","+","?","$","{","}","(",")","[","]","\\","/"].join("\\")}]`,"g");return e.replace(t,"\\$&")})(t),t=Tt(t,P,Bt)),new RegExp(t,"i")},Gt=(e,t,r)=>((e,t)=>{let r="";switch(e){case At:case It:r=Dt(t);break;case Ct:r=t.replace(/^(["'])([\s\S]*)\1$/,"$2");break;case Lt:r=Rt?(Math.round(100*parseFloat(t))/100).toString():t;break;default:r=t}return r})(t,window.getComputedStyle(e,r).getPropertyValue(t)),Ut=(e,t)=>{const r=e.indexOf(t);let s,o;return r>-1?(s=e.substring(0,r).trim(),o=e.substring(r+1).trim()):s=e,{name:s,value:o}},jt=e=>{const{pseudoName:t,pseudoArg:r,domElement:s}=e,{regularPseudoElement:o,styleMatchArg:n}=((e,t)=>{const{name:r,value:s}=Ut(t,v);let o=r,n=s;if(Object.values(se).includes(r)||(o=null,n=t),!n)throw new Error(`Required style property argument part is missing in :${e}() arg: '${t}'`);return o&&(o=`::${o}`),{regularPseudoElement:o,styleMatchArg:n}})(t,r),{name:l,value:a}=Ut(n,g);if(!l||!a)throw new Error(`Required property name or value is missing in :${t}() arg: '${n}'`);let i;try{i=Vt(a)}catch(e){throw xt.error(St(e)),new Error(`Invalid argument of :${t}() pseudo-class: '${n}'`)}const c=Gt(s,l,o);return i&&i.test(c)},qt=e=>!e.includes(p)&&!!/^[\w-]+$/.test(e),Ht=function(e){let t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.length>1&&e.startsWith(y)&&e.endsWith(y)&&(e=e.slice(1,-1)),""===e)throw new Error("Argument should be specified. Empty arg is invalid.");if(e.startsWith(p)&&e.endsWith(p)){if(!(e.length>2))throw new Error(`Invalid regexp: '${e}'`);t=Nt(e)}else if(e.includes(P)){if(e===P&&!r)throw new Error(`Argument should be more specific than ${e}`);t=Tt(e,P,Bt),t=new RegExp(t)}else{if(!qt(e))throw new Error(`Invalid argument: '${e}'`);t=e}return t},_t=(e,t)=>{const{name:r,value:s}=Ut(t,$);if(!r)throw new Error(`Required attribute name is missing in :${e} arg: ${t}`);return{rawName:r,rawValue:s}},Qt=e=>{const{pseudoName:t,pseudoArg:r,domElement:s}=e,o=s.attributes;if(0===o.length)return!1;const{rawName:n,rawValue:l}=_t(t,r);let a;try{a=Ht(n)}catch(e){const t=St(e);throw xt.error(t),new SyntaxError(t)}let i=!1,c=0;for(;c<o.length&&!i;){const e=o[c];if(!e)break;const t=a instanceof RegExp?a.test(e.name):a===e.name;if(l){let r;try{r=Ht(l)}catch(e){const t=St(e);throw xt.error(t),new SyntaxError(t)}const s=r instanceof RegExp?r.test(e.value):r===e.value;i=t&&s}else i=t;c+=1}return i},zt=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const s=Re(t);if(1===t.length){let t;for(t in e)s instanceof RegExp?s.test(t)&&r.push({base:e,prop:t,value:e[t]}):s===t&&r.push({base:e,prop:s,value:e[t]});return r}if(s instanceof RegExp){const o=t.slice(1),n=[];for(const t in e)s.test(t)&&n.push(t);n.forEach((t=>{var s;const n=null===(s=Object.getOwnPropertyDescriptor(e,t))||void 0===s?void 0:s.value;zt(n,o,r)}))}if(e&&"string"==typeof s){var o;const n=null===(o=Object.getOwnPropertyDescriptor(e,s))||void 0===o?void 0:o.value;t=t.slice(1),void 0!==n&&zt(n,t,r)}return r},Kt=e=>{const{pseudoName:t,pseudoArg:r,domElement:s}=e,{rawName:o,rawValue:n}=_t(t,r);if(o.includes("\\/")||o.includes("\\."))throw new Error(`Invalid :${t} name pattern: ${o}`);let l;try{l=(e=>{e.length>1&&e.startsWith(y)&&e.endsWith(y)&&(e=e.slice(1,-1));const t=e.split("."),r=[];let s="",o=!1,n=0;for(;n<t.length;){const l=Ce(t,n,`Invalid pseudo-class arg: '${e}'`);l.startsWith(p)&&l.endsWith(p)&&l.length>2?r.push(l):l.startsWith(p)?(o=!0,s+=l):l.endsWith(p)?(o=!1,s+=`.${l}`,r.push(s),s=""):o?s+=l:r.push(l),n+=1}if(s.length>0)throw new Error(`Invalid regexp property pattern '${e}'`);return r.map((t=>{if(0===t.length)throw new Error(`Empty pattern '${t}' is invalid in chain '${e}'`);let r;try{r=Ht(t,!0)}catch(r){throw xt.error(St(r)),new Error(`Invalid property pattern '${t}' in property chain '${e}'`)}return r}))})(o)}catch(e){const t=St(e);throw xt.error(t),new SyntaxError(t)}const a=zt(s,l);if(0===a.length)return!1;let i=!0;if(n){let e;try{e=Ht(n)}catch(e){const t=St(e);throw xt.error(t),new SyntaxError(t)}if(e)for(let t=0;t<a.length;t+=1){var c;const r=null===(c=a[t])||void 0===c?void 0:c.value;if(e instanceof RegExp)i=e.test(Pt(r));else{if("null"===r||"undefined"===r){i=e===r;break}i=Ot(e)===r}if(i)break}}return i},Xt=e=>{const{pseudoName:t,pseudoArg:r,domElement:s}=e,o=(e=>bt.getter?bt.getter.apply(e):e.textContent||"")(s);let n,l=r;if(l.startsWith(p)&&Mt.test(l)){const e=l.lastIndexOf("/"),s=l.substring(e+1);let a;l=l.substring(0,e+1).slice(1,-1).replace(/\\([\\"])/g,"$1");try{a=new RegExp(l,s)}catch(e){throw new Error(`Invalid argument of :${t}() pseudo-class: ${r}`)}n=a.test(o)}else l=l.replace(/\\([\\()[\]"])/g,"$1"),n=o.includes(l);return n},Jt=(e,t,r)=>`Error while matching element ${e}, may be invalid :${t}() pseudo-class arg: '${r}'`,Yt=(e,t,r)=>{let s,o,n;switch(t){case M:case D:case F:n=Xt,s={pseudoName:t,pseudoArg:r,domElement:e},o=Jt("text content",t,r);break;case W:case G:case V:n=jt,s={pseudoName:t,pseudoArg:r,domElement:e},o=Jt("style",t,r);break;case U:n=Qt,s={domElement:e,pseudoName:t,pseudoArg:r},o=Jt("attributes",t,r);break;case j:n=Kt,s={domElement:e,pseudoName:t,pseudoArg:r},o=Jt("properties",t,r);break;default:throw new Error(`Unknown absolute pseudo-class :${t}()`)}return((e,t,r)=>{let s;try{s=e(t)}catch(e){throw xt.error(St(e)),new Error(r)}return s})(n,s,o)},Zt=(e,t,r)=>{const s=((e,t)=>{const r=Number(e);if(Number.isNaN(r)||r<1||r>=256)throw new Error(`Invalid argument of :${t} pseudo-class: '${e}'`);return r})(t,r),o=e.map((e=>{let t=null;try{t=((e,t,r)=>{let s=null,o=0;for(;o<t;){if(s=e.parentElement,!s)throw new Error(`Out of DOM: Argument of :${r}() pseudo-class is too big — '${t}'.`);e=s,o+=1}return s})(e,s,r)}catch(e){xt.error(St(e))}return t})).filter($t);return o},er=(e,t)=>{const r=e.map((e=>{const r=[];let s;try{s=document.evaluate(t,e,null,window.XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null)}catch(e){throw xt.error(St(e)),new Error(`Invalid argument of :xpath() pseudo-class: '${t}'`)}let o=s.iterateNext();for(;o;)$t(o)&&r.push(o),o=s.iterateNext();return r}));return Oe(r)},tr=(e,t)=>{if(!(e=>{let t;try{document.querySelectorAll(e),t=!0}catch(e){t=!1}return t})(t))throw new Error(`Invalid argument of :upward pseudo-class: '${t}'`);return e.map((e=>{const r=e.parentElement;return r?r.closest(t):null})).filter($t)},rr=(e,t)=>((e,t)=>{const r=je(e),s=Re(r);if(!s)throw new Error(t||Le);return s})(e.children,`RegularSelector is missing for :${t}() pseudo-class`),sr=(e,t,r)=>{const s=r||Ue(e);let o=[];try{o=Array.from(t.querySelectorAll(s))}catch(e){throw new Error(`Error: unable to select by '${s}' — ${St(e)}`)}return o},or=(e,t)=>{let r=[];const s=_e(t),o=Ge(s);if(rt(o)){const t=Ue(s,`Missing arg for :${o}() pseudo-class`);if(o===H)r=Zt(e,t,o);else if(o===q){try{document.createExpression(t,null)}catch(e){throw new Error(`Invalid argument of :${o}() pseudo-class: '${t}'`)}r=er(e,t)}else r=o===Q?Number.isNaN(Number(t))?tr(e,t):Zt(e,t,o):e.filter((e=>Yt(e,o,t)))}else{if(!st(o))throw new Error(`Unknown extended pseudo-class: '${o}'`);{const t=Qe(s);let n;switch(o){case"has":case K:n=e=>(e=>{const{element:t,relativeSelectorList:r,pseudoName:s}=e;return r.children.every((e=>{const r=rr(e,s);let o="",n=null;const l=Ue(r);if(l.startsWith(A)||l.startsWith(I)?(n=t.parentElement,o=`:scope>${yt(t)}${l}`):l===P?(n=t,o=":scope *"):(o=`:scope ${l}`,n=t),!n)throw new Error(`Selection by :${s}() pseudo-class is not possible`);let a;try{a=lr(e,n,o)}catch(e){throw xt.error(St(e)),new Error(`Invalid selector for :${s}() pseudo-class: '${l}'`)}return a.length>0}))})({element:e,relativeSelectorList:t,pseudoName:o});break;case J:n=e=>(e=>{const{element:t,relativeSelectorList:r,pseudoName:s}=e;return r.children.some((e=>{const r=rr(e,s),o=kt(t,`Selection by :${s}() pseudo-class is not possible`),n=`:scope>${Ue(r)}`;let l;try{l=lr(e,o,n)}catch(e){return!1}return l.includes(t)}))})({element:e,relativeSelectorList:t,pseudoName:o});break;case Y:n=e=>(e=>{const{element:t,relativeSelectorList:r,pseudoName:s}=e;return r.children.every((e=>{const r=rr(e,s),o=kt(t,`Selection by :${s}() pseudo-class is not possible`),n=`:scope>${Ue(r)}`;let l;try{l=lr(e,o,n)}catch(e){throw xt.error(St(e)),new Error(`Invalid selector for :${s}() pseudo-class: '${Ue(r)}'`)}return!l.includes(t)}))})({element:e,relativeSelectorList:t,pseudoName:o});break;default:throw new Error(`Unknown relative pseudo-class: '${o}'`)}r=e.filter(n)}}return r},nr=(e,t)=>{let r=[];const s=Ue(t);return r=s.startsWith(R)?e.map((e=>sr(t,e,`:scope${s}`))):s.startsWith(A)||s.startsWith(I)?e.map((e=>{const r=e.parentElement;if(!r)return[];const o=yt(e);return sr(t,r,`:scope>${o}${s}`)})):e.map((e=>{const r=`:scope ${Ue(t)}`;return sr(t,e,r)})),Oe(r)},lr=(e,t,r)=>{let s=[],o=0;for(;o<e.children.length;){const n=Ce(e.children,o,"selectorNodeChild should be specified");0===o?s=sr(n,t,r):Fe(n)?s=or(s,n):De(n)&&(s=nr(s,n)),o+=1}return s},ar=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;const r=[];e.children.forEach((e=>{r.push(...lr(e,t))}));const s=[...new Set(Oe(r))];return s};const ir=new class{constructor(){this.astCache=new Map}saveAstToCache(e,t){this.astCache.set(e,t)}getAstFromCache(e){return this.astCache.get(e)||null}getSelectorAst(e){let t=this.getAstFromCache(e);return t||(t=Et(e)),this.saveAstToCache(e,t),t}querySelectorAll(e){const t=this.getSelectorAst(e);return ar(t)}},cr="debug",ur=e=>{const t=`:remove${h.LEFT}${h.RIGHT}`,r=`:remove${h.LEFT}`;let s,o=!1;const n=e.indexOf(t);if(0===n)throw new Error(`${ve}: '${e}'`);if(n>0){if(n!==e.lastIndexOf(t))throw new Error(`${Ee}: '${e}'`);if(n+t.length<e.length)throw new Error(`${ge}: '${e}'`);s=e.substring(0,n),o=!0}else{if(e.includes(r))throw new Error(`${me}: '${e}'`);s=e}return{selector:s,stylesOfSelector:o?[{property:z,value:ne}]:[]}},dr=(e,t)=>{let r,s=e.trim();if(s.startsWith("@"))throw new Error(`At-rules are not supported: '${s}'.`);try{r=ur(s)}catch(e){throw xt.error(St(e)),new Error(`${me}: '${s}'`)}let o,n=[],l=!1;try{s=r.selector,n=r.stylesOfSelector,o=t.getSelectorAst(s),l=!0}catch(e){l=!1}return{success:l,selector:s,ast:o,stylesOfSelector:n}},hr=()=>new Map,fr=(e,t)=>{const{selector:r,ast:s,rawStyles:o}=t;if(!o)throw new Error(`No style declaration for selector: '${r}'`);if(!s)throw new Error(`No ast parsed for selector: '${r}'`);const n=e.get(r);n?n.styles.push(...o):e.set(r,{ast:s,styles:o})},pr=e=>{const{selector:t,ast:r,rawStyles:s}=e;if(!r)throw new Error(`AST should be parsed for selector: '${t}'`);if(!s)throw new Error(`Styles should be parsed for selector: '${t}'`);const o={selector:t,ast:r},n=(e=>{const t=e.find((e=>e.property===cr));return null==t?void 0:t.value})(s),l=(e=>e.some((e=>e.property===z&&e.value===ne)))(s);let a=s;if(n&&(a=s.filter((e=>e.property!==cr)),n!==ne&&n!==le||(o.debug=n)),l){o.style={[z]:ne};const e=a.find((e=>e.property===oe));e&&(o.style.content=e.value)}else if(a.length>0){const e=(e=>{const t={};return e.forEach((e=>{const[r,s]=e;t[r]=s})),t})(a.map((e=>{const{property:t,value:r}=e;return[t,r]})));o.style=e}return o},wr=e=>{const t=[];return e.forEach(((e,r)=>{const s=r,{ast:o,styles:n}=e;t.push(pr({selector:s,ast:o,rawStyles:n}))})),t},mr="property",vr="value",Er=e=>""!==e.bufferValue&&null!==e.valueQuoteMark,gr=e=>{e.styles.push({property:e.bufferProperty.trim(),value:e.bufferValue.trim()}),e.bufferProperty="",e.bufferValue=""},br=(e,t,r)=>{const{value:s}=r;switch(r.type){case Ne:if(e.bufferProperty.length>0)throw new Error(`Invalid style property in style block: '${t}'`);e.bufferProperty+=s;break;case Te:if(s===g){if(0===e.bufferProperty.trim().length)throw new Error(`Missing style property before ':' in style block: '${t}'`);e.bufferProperty=e.bufferProperty.trim(),e.processing=vr}else if(!N.includes(s))throw new Error(`Invalid style declaration in style block: '${t}'`);break;default:throw new Error(`Unsupported style property character: '${s}' in style block: '${t}'`)}},yr=(e,t,r)=>{const{value:s}=r;if(r.type===Ne)e.bufferValue+=s;else switch(s){case g:if(!Er(e))throw new Error(`Invalid style value for property '${e.bufferProperty}' in style block: '${t}'`);e.bufferValue+=s;break;case E:Er(e)?e.bufferValue+=s:(gr(e),e.processing=mr);break;case b:case y:null===e.valueQuoteMark?e.valueQuoteMark=s:e.bufferValue.endsWith(w)||e.valueQuoteMark!==s||(e.valueQuoteMark=null),e.bufferValue+=s;break;case w:if(!Er(e))throw new Error(`Invalid style value for property '${e.bufferProperty}' in style block: '${t}'`);e.bufferValue+=s;break;case m:case k:case S:case x:case T:e.bufferValue.length>0&&(e.bufferValue+=s);break;default:throw new Error(`Unknown style declaration token: '${s}'`)}},$r=e=>{const t=e.trim(),r=(e=>{const t=e.trim();return Pe(t,B)})(t),s={processing:mr,styles:[],bufferProperty:"",bufferValue:"",valueQuoteMark:null};let o=0;for(;o<r.length;){const e=r[o];if(!e)break;if(s.processing===mr)br(s,t,e);else{if(s.processing!==vr)throw new Error("Style declaration parsing failed");yr(s,t,e)}o+=1}if(Er(s))throw new Error(`Unbalanced style declaration quotes in style block: '${t}'`);if(s.bufferProperty.length>0){if(0===s.bufferValue.length)throw new Error(`Missing style value for property '${s.bufferProperty}' in style block '${t}'`);gr(s)}if(0===s.styles.length)throw new Error(ie);return s.styles},kr=(e,t)=>{var r;const s=e.trim();if(s.includes("/*")&&s.includes("*/"))throw new Error(we);const o=(e=>{const t=[];for(let r=0;r<e.length;r+=1)e[r]===f.LEFT&&t.push(r);return t})(s);if(0===Re(o))throw new Error(ae);let n,l,a;if(o.length>0&&!s.includes(f.RIGHT))throw new Error(`${ie} OR ${de}`);if(0===o.length||!s.includes(f.RIGHT))try{if(n=dr(s,t),n.success){var i;if(0===(null===(i=n.stylesOfSelector)||void 0===i?void 0:i.length))throw new Error(pe);return{selector:n.selector.trim(),ast:n.ast,rawStyles:n.stylesOfSelector}}throw new Error("Invalid selector")}catch(e){throw new Error(St(e))}const c={selector:""};for(let e=o.length-1;e>-1;e-=1){const r=o[e];if(!r)throw new Error(`Impossible to continue, no '{' to process for rule: '${s}'`);if(l=s.slice(0,r),a=s.slice(r+1,s.length-1),n=dr(l,t),n.success){var u;c.selector=n.selector.trim(),c.ast=n.ast,c.rawStyles=n.stylesOfSelector;const e=$r(a);null===(u=c.rawStyles)||void 0===u||u.push(...e);break}}if(0===(null===(r=c.selector)||void 0===r?void 0:r.length))throw new Error("Selector in not valid");return c},Sr=/[;}]/g,xr=/[;:}]/g,Tr=/\S/g,Nr=e=>{e.rawRuleData={selector:""}},Pr=(e,t)=>{let r,s=e.selectorBuffer.trim();if(s.startsWith("@"))throw new Error(`At-rules are not supported: '${s}'.`);try{r=ur(s)}catch(e){throw xt.error(St(e)),new Error(`${me}: '${s}'`)}if(-1===e.nextIndex){if(s===r.selector)throw new Error(`${pe}: '${e.cssToParse}'`);e.cssToParse=""}let o,n=[],l=!1;try{s=r.selector,n=r.stylesOfSelector,o=t.getSelectorAst(s),l=!0}catch(e){l=!1}return e.nextIndex>0&&(e.cssToParse=e.cssToParse.slice(e.nextIndex)),{success:l,selector:s,ast:o,stylesOfSelector:n}},Or=(e,t)=>{xr.lastIndex=e.nextIndex;let r=xr.exec(e.cssToParse);if(null===r)throw new Error(`${ue}: '${e.cssToParse}'`);let s=r.index,o=r[0];if(o===f.RIGHT){if(0!==e.cssToParse.slice(e.nextIndex,s).trim().length)throw new Error(`${ue}: '${e.cssToParse}'`);if(0===t.length)throw new Error(`${ie}: '${e.cssToParse}'`);return s}if(o===g){const n=s;if(Sr.lastIndex=n,r=Sr.exec(e.cssToParse),null===r)throw new Error(`${de}: '${e.cssToParse}'`);s=r.index,o=r[0];const l=e.cssToParse.slice(e.nextIndex,n).trim();if(0===l.length)throw new Error(`${he}: '${e.cssToParse}'`);const a=e.cssToParse.slice(n+1,s).trim();if(0===a.length)throw new Error(`${fe}: '${e.cssToParse}'`);if(t.push({property:l,value:a}),o===f.RIGHT)return s}return e.cssToParse=e.cssToParse.slice(s+1),e.nextIndex=0,Or(e,t)},Rr=e=>{const t=[],r=Or(e,t);Tr.lastIndex=r+1;const s=Tr.exec(e.cssToParse);if(null===s)return e.cssToParse="",t;const o=s.index;return e.cssToParse=e.cssToParse.slice(o),t},Ar=e=>"number"==typeof e&&!Number.isNaN(e),Ir=void 0!==window.requestAnimationFrame,Cr=Ir?requestAnimationFrame:window.setTimeout,Lr=Ir?cancelAnimationFrame:clearTimeout,Br=Ir?performance:Date;class Mr{constructor(e,t,r){this.context=e,this.callback=t,this.throttleDelayMs=r||150,this.wrappedCb=this.wrappedCallback.bind(this)}wrappedCallback(e){this.lastRunTime=Ar(e)?e:Br.now(),this.timeoutId&&(Lr(this.timeoutId),delete this.timeoutId),clearTimeout(this.timerId),delete this.timerId,this.callback&&this.callback(this.context)}hasPendingCallback(){return Ar(this.timeoutId)||Ar(this.timerId)}run(){if(!this.hasPendingCallback()){if(void 0!==this.lastRunTime){const e=Br.now()-this.lastRunTime;if(e<this.throttleDelayMs)return void(this.timerId=window.setTimeout(this.wrappedCb,this.throttleDelayMs-e))}this.timeoutId=Cr(this.wrappedCb)}}static now(){return Br.now()}}const Dr=["mouseover","mouseleave","mouseenter","mouseout"],Fr=["keydown","keypress","keyup","auxclick","click","contextmenu","dblclick","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseout","mouseup","pointerlockchange","pointerlockerror","select","wheel"],Wr=["wheel"];class Vr{constructor(){e(this,"getLastEventType",(()=>this.lastEventType)),e(this,"getTimeSinceLastEvent",(()=>this.lastEventTime?Date.now()-this.lastEventTime:null)),this.trackedEvents=Rt?Fr.filter((e=>!Wr.includes(e))):Fr,this.trackedEvents.forEach((e=>{document.documentElement.addEventListener(e,this.trackEvent,!0)}))}trackEvent(e){this.lastEventType=e.type,this.lastEventTime=Date.now()}isIgnoredEventType(){const e=this.getLastEventType(),t=this.getTimeSinceLastEvent();return!!e&&Dr.includes(e)&&!!t&&t<10}stopTracking(){this.trackedEvents.forEach((e=>{document.documentElement.removeEventListener(e,this.trackEvent,!0)}))}}const Gr=void 0!==window.addEventListener,Ur=(e,t)=>{e.isDomObserved||(e.isDomObserved=!0,((e,t)=>{gt.MutationObserver?(e.domMutationObserver=new gt.MutationObserver((r=>{if(!r||0===r.length)return;const s=new Vr;s.isIgnoredEventType()&&(e=>e.every((e=>"attributes"===e.type)))(r)||(e.eventTracker=s,t())})),e.domMutationObserver.observe(document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["id","class"]})):Gr&&(document.addEventListener("DOMNodeInserted",t,!1),document.addEventListener("DOMNodeRemoved",t,!1),document.addEventListener("DOMAttrModified",t,!1))})(e,t))},jr=(e,t)=>{e.isDomObserved&&(e.isDomObserved=!1,((e,t)=>{var r;e.domMutationObserver?e.domMutationObserver.disconnect():Gr&&(document.removeEventListener("DOMNodeInserted",t,!1),document.removeEventListener("DOMNodeRemoved",t,!1),document.removeEventListener("DOMAttrModified",t,!1)),null===(r=e.eventTracker)||void 0===r||r.stopTracking()})(e,t))},qr=/^("|')adguard.+?/,Hr=(e,t)=>{const{node:r}=t;t.removed=!0;const s=(e=>{if(!(e instanceof Element))throw new Error("Function received argument with wrong type");let t;t=e;const r=[];for(;t&&t.nodeType===Node.ELEMENT_NODE;){let e=t.nodeName.toLowerCase();if(t.id&&"string"==typeof t.id){e+=`#${t.id}`,r.unshift(e);break}let s=t,o=1;for(;s.previousElementSibling;)s=s.previousElementSibling,s.nodeType===Node.ELEMENT_NODE&&s.nodeName.toLowerCase()===e&&(o+=1);1!==o&&(e+=`:nth-of-type(${o})`),r.unshift(e),t=t.parentElement}return r.join(" > ")})(r),o=e.removalsStatistic[s]||0;o>50?xt.error(`ExtendedCss: infinite loop protection for selector: '${s}'`):r.parentElement&&(r.parentElement.removeChild(r),e.removalsStatistic[s]=o+1)},_r=(e,t)=>{e instanceof HTMLElement&&Object.keys(t).forEach((r=>{if(void 0!==e.style.getPropertyValue(r.toString())){let s=t[r];if(!s)return;if(r===oe&&s.match(qr))return;s=((e,t)=>{const r=e.indexOf(t,e.length-t.length);return r>=0?e.substring(0,r):e})(s.trim(),"!important").trim(),e.style.setProperty(r,s,"important")}}))},Qr=(e,t)=>{if(t.protectionObserver)return;let r;if(e.beforeStyleApplied){if(!(e=>!e.rules.some((e=>!e.style||!e.style.content)))(t))throw new Error("Rule style property 'content' should be defined");if(r=e.beforeStyleApplied(t),!r)throw new Error("Callback 'beforeStyleApplied' should return IAffectedElement");if(!(e=>!e.rules.some((e=>e.style&&""!==e.style.content)))(r))throw new Error("Rules should have empty string as 'content' style value")}else r=t;const{node:s,rules:o}=r;for(let t=0;t<o.length;t+=1){const n=o[t],l=null==n?void 0:n.selector,a=null==n?void 0:n.style,i=null==n?void 0:n.debug;if(a){if(a.remove===ne)return void Hr(e,r);_r(s,a)}else if(!i)throw new Error(`No style declaration in rule for selector: '${l}'`)}},zr=e=>{e.protectionObserver&&e.protectionObserver.disconnect(),e.node.style.cssText=e.originalStyle};class Kr{constructor(e){this.styleProtectionCount=0,this.observer=new gt.MutationObserver((t=>{t.length&&(this.styleProtectionCount+=1,e(t,this))}))}observe(e,t){this.styleProtectionCount<50?this.observer.observe(e,t):xt.error("ExtendedCss: infinite loop protection for style")}disconnect(){this.observer.disconnect()}}const Xr={attributes:!0,attributeOldValue:!0,attributeFilter:["style"]},Jr=(e,t)=>{if(!gt.MutationObserver)return null;const r=[];t.forEach((e=>{const{style:t}=e;t&&r.push(t)}));const s=new Kr((e=>(t,r)=>{if(!t[0])return;const{target:s}=t[0];r.disconnect(),e.forEach((e=>{_r(s,e)})),r.observe(s,Xr)})(r));return s.observe(e,Xr),s};class Yr{constructor(){this.appliesTimings=[],this.appliesCount=0,this.timingsSum=0,this.meanTiming=0,this.squaredSum=0,this.standardDeviation=0}push(e){this.appliesTimings.push(e),this.appliesCount+=1,this.timingsSum+=e,this.meanTiming=this.timingsSum/this.appliesCount,this.squaredSum+=e*e,this.standardDeviation=Math.sqrt(this.squaredSum/this.appliesCount-Math.pow(this.meanTiming,2))}}const Zr=e=>Number(e.toFixed(4)),es=e=>{const t=[];jr(e,e.mainCallback),e.parsedRules.forEach((r=>{const s=((e,t)=>{const r=!!t.debug||e.debug;let s;r&&(s=Mr.now());const{ast:o}=t,n=[];try{n.push(...ar(o))}catch(t){e.debug&&xt.error(St(t))}if(n.forEach((r=>{let s=(o=e.affectedElements,n=r,o.find((e=>e.node===n)));var o,n;if(s)s.rules.push(t),Qr(e,s);else{const o=r.style.cssText;s={node:r,rules:[t],originalStyle:o,protectionObserver:null},Qr(e,s),e.affectedElements.push(s)}})),r&&s){const e=Mr.now()-s;t.timingStats||(t.timingStats=new Yr),t.timingStats.push(e)}return n})(e,r);Array.prototype.push.apply(t,s),r.debug&&(r.matchedElements=s)}));let r=e.affectedElements.length;for(;r;){const s=e.affectedElements[r-1];if(!s)break;t.includes(s.node)?s.removed||s.protectionObserver||(s.protectionObserver=Jr(s.node,s.rules)):(zr(s),e.affectedElements.splice(r-1,1)),r-=1}Ur(e,e.mainCallback),(e=>{if(e.areTimingsPrinted)return;e.areTimingsPrinted=!0;const t={};e.parsedRules.forEach((e=>{if(e.timingStats){const{selector:s,style:o,debug:n,matchedElements:l}=e;if(!o&&!n)throw new Error(`Rule should have style declaration for selector: '${s}'`);const a={selectorParsed:s,timings:(r=e.timingStats,{appliesTimings:r.appliesTimings.map((e=>Zr(e))),appliesCount:Zr(r.appliesCount),timingsSum:Zr(r.timingsSum),meanTiming:Zr(r.meanTiming),standardDeviation:Zr(r.standardDeviation)})};o&&o.remove===ne?a.removed=!0:(a.styleApplied=o||null,a.matchedElements=l),t[s]=a}var r})),0!==Object.keys(t).length&&xt.info("[ExtendedCss] Timings in milliseconds for %o:\n%o",window.location.href,t)})(e)};class ts{constructor(e){var t;if(((t=navigator.userAgent).includes("MSIE")||t.includes("Trident/"))&&xt.error("Browser is not supported by ExtendedCss"),!e)throw new Error("ExtendedCss configuration should be provided.");if(this.context={beforeStyleApplied:e.beforeStyleApplied,debug:!1,affectedElements:[],isDomObserved:!1,removalsStatistic:{},parsedRules:[],mainCallback:()=>{}},!e.styleSheet&&!e.cssRules)throw new Error("ExtendedCss configuration should have 'styleSheet' or 'cssRules' defined.");if(e.styleSheet)try{this.context.parsedRules.push(...((e,t)=>{const r=e.trim();if(r.includes("/*")&&r.includes("*/"))throw new Error(`${we} in stylesheet: '${r}'`);const s={isSelector:!0,nextIndex:0,cssToParse:r,selectorBuffer:"",rawRuleData:{selector:""}},o=hr();let n;for(;s.cssToParse;)if(s.isSelector){if(s.nextIndex=s.cssToParse.indexOf(f.LEFT),0===s.selectorBuffer.length&&0===s.nextIndex)throw new Error(`${ce}: '${s.cssToParse}'`);-1===s.nextIndex?s.selectorBuffer=s.cssToParse:s.selectorBuffer+=s.cssToParse.slice(0,s.nextIndex),n=Pr(s,t),n.success?(s.rawRuleData.selector=n.selector.trim(),s.rawRuleData.ast=n.ast,s.rawRuleData.rawStyles=n.stylesOfSelector,s.isSelector=!1,-1===s.nextIndex?(fr(o,s.rawRuleData),Nr(s)):(s.nextIndex=1,s.selectorBuffer="")):(s.selectorBuffer+=f.LEFT,s.cssToParse=s.cssToParse.slice(1))}else{var l;const e=Rr(s);null===(l=s.rawRuleData.rawStyles)||void 0===l||l.push(...e),fr(o,s.rawRuleData),s.nextIndex=0,Nr(s),s.isSelector=!0}return wr(o)})(e.styleSheet,ir))}catch(e){throw new Error(`Pass the rules as configuration.cssRules since configuration.styleSheet cannot be parsed because of: '${St(e)}'`)}if(e.cssRules&&this.context.parsedRules.push(...((e,t)=>{const r=hr(),s=[];return[...new Set(e.map((e=>e.trim())))].forEach((e=>{try{fr(r,kr(e,t))}catch(t){const r=St(t);s.push(`'${e}' - error: '${r}'`)}})),s.length>0&&xt.info(`Invalid rules:\n  ${s.join("\n  ")}`),wr(r)})(e.cssRules,ir)),this.context.debug=e.debug||this.context.parsedRules.some((e=>e.debug===le)),this.applyRulesScheduler=new Mr(this.context,es,150),this.context.mainCallback=this.applyRulesScheduler.run.bind(this.applyRulesScheduler),this.context.beforeStyleApplied&&"function"!=typeof this.context.beforeStyleApplied)throw new Error(`Invalid configuration. Type of 'beforeStyleApplied' should be a function, received: '${typeof this.context.beforeStyleApplied}'`);this.applyRulesCallbackListener=()=>{es(this.context)}}init(){bt.setGetter()}apply(){es(this.context),"complete"!==document.readyState&&document.addEventListener("DOMContentLoaded",this.applyRulesCallbackListener,!1)}dispose(){jr(this.context,this.context.mainCallback),this.context.affectedElements.forEach((e=>{zr(e)})),document.removeEventListener("DOMContentLoaded",this.applyRulesCallbackListener,!1)}getAffectedElements(){return this.context.affectedElements}static query(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("string"!=typeof e)throw new Error("Selector should be defined as a string.");const r=Mr.now();try{return ir.querySelectorAll(e)}finally{const e=Mr.now();t||xt.info(`[ExtendedCss] Elapsed: ${Math.round(1e3*(e-r))} μs.`)}}static validate(e){try{const{selector:t}=ur(e);return ts.query(t),{ok:!0,error:null}}catch(t){return{ok:!1,error:`Error: Invalid selector: '${e}' -- ${St(t)}`}}}}return ts}();